<source>
  @type forward
  port 24224
  bind 0.0.0.0
</source>

<filter docker.**>
  @type record_transformer
  enable_ruby true

  <record>
    container_id   ${record.dig("docker", "container_id")}
    container_name ${record.dig("docker", "container_name")}
    image          ${record.dig("docker", "image")}
    service        ${record.dig("docker", "service")}
    stream         ${record["stream"]}
    log            ${record["log"]}
    timestamp      ${time.strftime('%Y-%m-%dT%H:%M:%S%z')}
  </record>
</filter>

<match docker.**>
  @type elasticsearch

  scheme http
  host elasticsearch
  port 9200

  ssl_verify false

  index_name fluentd-%Y.%m.%d
  logstash_format true
  include_tag_key true
  tag_key tag
  reconnect_on_error true
  request_timeout 30s
  suppress_type_name true
</match>